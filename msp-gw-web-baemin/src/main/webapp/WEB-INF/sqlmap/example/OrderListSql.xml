<?xml version="1.0" encoding="UTF-8"?>
        <!DOCTYPE mapper
                PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
                "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="OrderList">
	
	<select id="autoOrderNum" resultType="String">
		SELECT CONCAT('order', NVL(MAX(SUBSTR(ORDER_NUM, 6)), 10000)+1) FROM ORDERLIST
	</select>
	
	<select id="autoObjectNum" resultType="String">
		SELECT CONCAT('object', NVL(MAX(SUBSTR(OBJECT_NUM, 7)), 10000)+1) FROM ORDERLIST
	</select>
	
	<select id="getQty" parameterType="map" resultType="int">
		SELECT BUY_QTY FROM ORDERLIST
		WHERE OBJECT_NUM = #{objectNum}
	</select>
	
	<select id="getObjPrice" parameterType="map" resultType="int">
		SELECT OBJECT_PRICE FROM OBJECT
		WHERE OBJECT_NUM = #{objectNum}
	</select>
	
	<insert id="insertOrder">
		INSERT INTO ORDERLIST
		VALUES
	    	(#{objectNum}, #{memberNum}, #{buyQty})
	</insert>
	
	<delete id="deleteOneOrder">
		DELETE FROM ORDERLIST
		WHERE OBJECT_NUM = #{objectNum}
	</delete>
	
	<delete id="deleteOrder">
		DELETE FROM ORDERLIST
	</delete>
	
	<update id="updateOrder">
		UPDATE ORDERLIST
		SET    BUY_QTY = #{buyQty}
		
		WHERE OBJECT_NUM = #{objectNum}
	</update>
	
	<select id="selectAll" parameterType="map" resultType="edu.example.dto.OrderListAllDto">
		SELECT ob.OBJECT_NUM, s.STORE_NUM, STORE_NAME, OBJECT_NAME, ob.OBJECT_PRICE, od.BUY_QTY, MEMBER_NUM, DELIVERY_PRICE
		FROM OBJECT ob, ORDERLIST od, STORE s 
		WHERE ob.OBJECT_NUM = od.OBJECT_NUM AND s.STORE_NUM = ob.STORE_NUM AND MEMBER_NUM = #{memberNum} AND s.STORE_NUM = #{storeNum}
	</select>
	
	<select id="objCheck" parameterType="map" resultType="edu.example.dto.Orderlist" >
		SELECT OBJECTNAME FROM ORDERLIST
		WHERE OBJECT_NUM = #{objectNum}
	</select>
	
</mapper>